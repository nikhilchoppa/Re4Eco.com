var lfb_isDraggingComponent=!1,lfb_elementHoverTimer=!1,lfb_currentFormID=0,lfb_currentStepID=0,lfb_currentStep=!1,lfb_editedItem=!1,lfb_copyHelper=null;function lfb_initVisualStep(e,t){lfb_currentStepID=e,jQuery(window).resize(function(){jQuery("#lfb_bootstraped").css({height:jQuery(window).height()})}),jQuery("#lfb_bootstraped").css({height:jQuery(window).height()});var a=e;0==a&&(a="final"),jQuery("#lfb_bootstraped").addClass("lfb_visualEditing"),jQuery("#estimation_popup").addClass("lfb_visualEditing"),jQuery("#estimation_popup").attr("data-animspeed","0"),jQuery("#estimation_popup .genSlide.lfb_activeStep").removeClass("lfb_activeStep"),jQuery("#estimation_popup .genSlide").hide(),jQuery('#estimation_popup .genSlide[data-stepid="'+a+'"]').show(),jQuery('#estimation_popup .genSlide[data-stepid="'+a+'"]').addClass("lfb_activeStep"),jQuery('#estimation_popup .genSlide[data-stepid="'+a+'"] .errorMsg').hide(),jQuery('#estimation_popup .genSlide[data-stepid="'+a+'"] .btn-next').show(),jQuery('#estimation_popup .genSlide[data-stepid="'+a+'"]').is('[data-start="1"]')||jQuery('#estimation_popup .genSlide[data-stepid="'+a+'"] .lfb_linkPreviousCt').show(),jQuery('#estimation_popup .genSlide[data-stepid="'+a+'"] .stepTitle').addClass("positioned"),jQuery('#estimation_popup .genSlide[data-stepid="'+a+'"] .genContent').css({opacity:1}),jQuery("#estimation_popup.wpe_bootstraped #mainPanel").show(),jQuery("#estimation_popup.wpe_bootstraped #wpe_panel > .container-fluid > .row").hide(),jQuery("#estimation_popup .lfb_item:not(.lfb_componentInitialized)").each(function(){jQuery(this).addClass("lfb_componentInitialized"),lfb_initItemToolbar(jQuery(this)),lfb_initItemContent(jQuery(this))}),lfb_resizeAll()}function lfb_getStepByID(e,t){for(var a=!1,i=0;i<t.steps.length;i++)if(t.steps[i].id==e){a=t.steps[i];break}return a}function lfb_refreshItemDom(i){jQuery.ajax({url:lfb_data.ajaxurl,type:"post",data:{action:"lfb_getItemDom",formID:lfb_currentFormID,itemID:i,stepID:jQuery("#estimation_popup .lfb_activeStep").attr("data-stepid")},success:function(e){var t,a=jQuery(e);0<i?((t=jQuery('#estimation_popup .lfb_item[data-id="'+i+'"]')).after(a),t.remove()):jQuery("#estimation_popup .lfb_activeStep > .genContent > .lfb_row").html(a),0<i?(lfb_initItemToolbar(a),lfb_initItemContent(a),lfb_initNewItemContent(a),a.find(".lfb_item").each(function(){lfb_initItemToolbar(jQuery(this)),lfb_initItemContent(jQuery(this)),lfb_initNewItemContent(jQuery(this))})):jQuery("#estimation_popup .lfb_activeStep > .genContent > .lfb_row").find(".lfb_item").each(function(){lfb_initItemToolbar(jQuery(this)),lfb_initItemContent(jQuery(this)),lfb_initNewItemContent(jQuery(this))})}})}function lfb_initRowMenu(){var e=jQuery('<div id="lfb_rowMenu" class="lfb_lPanel lfb_lPanelRight"></div>');e.append('<div class="lfb_lPanelHeader"><span class="fa fa-clock-o"></span><span id="lfb_lPanelHeaderTitle">'+lfb_data.texts["Row settings"]+'</span><a href="javascript:" id="lfb_rowMenuCloseBtn" class="btn btn-default btn-circle btn-inverse"><span class="glyphicon glyphicon-remove"></span></a></div>'),e.append(' <div class="lfb_lPanelBody"></div>'),jQuery("#lfb_bootstraped").append(e),e.find(".lfb_lPanelBody").append("<label>"+lfb_data.texts.Columns+"</label>"),e.find(".lfb_lPanelBody").append('<table class="table table-striped"></table>'),e.find(".table").append("<thead></thead>"),e.find(".table thead").append("<tr><th>"+lfb_data.texts.Size+'</th><th class="text-right"><a href="javascript:" data-action="addColumn" class="btn btn-primary btn-circle" title="'+lfb_data.texts["Add a column"]+'"><span class="fas fa-plus"></span></a></th></tr>'),e.find(".table").append("<tbody></tbody>"),e.find("#lfb_rowMenuCloseBtn").on("click",function(){e.removeClass("lfb_open")}),e.find('a[data-action="addColumn"]').click(function(){jQuery(this).closest("table"),jQuery(this).closest("tr[data-id]").attr("data-id");jQuery.ajax({url:lfb_data.ajaxurl,type:"post",data:{action:"lfb_createRowColumn",rowID:lfb_editedItem.attr("data-id")},success:function(e){addColumnRow({size:"medium",id:e})}})})}function addColumnRow(t){var e=jQuery("#lfb_rowMenu").find("table"),a=jQuery('<tr data-id="'+t.id+'"></tr>');a.append('<td><select name="size" class="form-control form-control-sm"></select></td>'),a.find('[name="size"]').append('<option value="auto">'+lfb_data.texts.Automatic+"</option>"),a.find('[name="size"]').append('<option value="small">'+lfb_data.texts.Small+"</option>"),a.find('[name="size"]').append('<option value="medium">'+lfb_data.texts.Medium+"</option>"),a.find('[name="size"]').append('<option value="large">'+lfb_data.texts.Large+"</option>"),a.find('[name="size"]').append('<option value="xl">'+lfb_data.texts.XL+"</option>"),a.find('[name="size"]').append('<option value="fullWidth">'+lfb_data.texts["Full width"]+"</option>"),a.append('<td class="text-right lfb_tdAction"></td>'),a.find(".lfb_tdAction").append('<a href="javascript:" data-action="deleteColumn" class="btn btn-danger btn-circle"><span class="fas fa-trash"></span></a>'),e.find("tbody").append(a),lfb_updateRowColumns(lfb_editedItem),lfb_refreshItemDom(lfb_editedItem.attr("data-id")),a.find('[name="size"]').val(t.size),a.find('[name="size"]').on("change",function(){var e=jQuery(this).val();lfb_updateRowColumns(lfb_editedItem),jQuery.ajax({url:lfb_data.ajaxurl,type:"post",data:{action:"lfb_editRowColumn",rowID:lfb_editedItem.attr("data-id"),columnID:t.id,size:e},success:function(){lfb_refreshItemDom(lfb_editedItem.attr("data-id"))}})}),a.find('[data-action="deleteColumn"]').on("click",function(){jQuery(this).closest("tr[data-id]").attr("data-id");jQuery(this).closest("tr[data-id]").remove(),jQuery.ajax({url:lfb_data.ajaxurl,type:"post",data:{action:"lfb_deleteRowColumn",rowID:lfb_editedItem.attr("data-id"),columnID:t.id},success:function(){lfb_updateRowColumns(lfb_editedItem),lfb_refreshItemDom(lfb_editedItem.attr("data-id"))}})})}function lfb_updateRowColumns(e){var t=new Array;jQuery("#lfb_rowMenu table tr[data-id]").each(function(){t.push({id:jQuery(this).attr("data-id"),size:jQuery(this).find('[name="size"]').val()})}),e.attr("data-columns",JSON.stringify(t))}function lfb_updateItemsSortOrder(){var t=new Array,a=new Array,i=new Array;jQuery("#estimation_popup .lfb_activeStep .lfb_item").each(function(){t.push(jQuery(this).attr("data-id")),a.push(jQuery(this).index());var e="";0<jQuery(this).closest(".lfb_column").length&&(e=jQuery(this).closest(".lfb_column").attr("data-columnid")),i.push(e)}),jQuery.ajax({url:lfb_data.ajaxurl,type:"post",data:{action:"lfb_itemsSort",stepID:lfb_currentStepID,itemsIDs:t,indexes:a,columnsIDs:i}})}function lfb_initComponentsMenu(){jQuery.ajax({url:lfb_data.ajaxurl,type:"post",data:{action:"lfb_getComponentMenu"},success:function(e){jQuery("#lfb_bootstraped").prepend(e),jQuery("#lfb_componentsCloseBtn").on("click",function(){jQuery("#lfb_componentsPanel").removeClass("lfb_open")}),jQuery("#estimation_popup").find(".genSlide .genContent > .lfb_row").sortable({connectWith:".lfb_sortable",revert:10,delay:200,scroll:!1,items:".lfb_item",receive:function(e,t){jQuery("#lfb_rowMenu").removeClass("lfb_open"),0<t.sender.closest(".lfb_lPanelBodyContent").length?lfb_renderComponent(t.item,""):(t.item.removeClass("col-md-12"),t.item.addClass("col-md-2"),setTimeout(function(){lfb_updateItemsSortOrder()},100)),lfb_copyHelper=null},start:function(e,t){jQuery("#estimation_popup").addClass("lfb_draggingComponent"),t.helper.css("background-color",jQuery("#mainPanel").css("background-color"))},over:function(e,t){},stop:function(e,t){jQuery("#estimation_popup").removeClass("lfb_draggingComponent"),setTimeout(function(){lfb_updateItemsSortOrder()},100)},update:function(e,t){}}).disableSelection(),jQuery("#lfb_componentsPanel .lfb_lPanelBodyContent").addClass("lfb_sortable").sortable({connectWith:".lfb_sortable",revert:10,delay:200,scroll:!1,appendTo:jQuery("#lfb_bootstraped"),items:".lfb_item",forcePlaceholderSize:!1,helper:function(e,t){return lfb_copyHelper=t.clone().insertAfter(t),t.clone()},start:function(e,t){lfb_isDraggingComponent=!0,t.helper.css("background-color",jQuery("#mainPanel").css("background-color")),jQuery(".lfb_tmpComponent").remove();jQuery('<div class="lfb_tmpComponent"></div>')},over:function(e,t){},stop:function(e,t){if(lfb_copyHelper&&lfb_copyHelper.remove(),lfb_isDraggingComponent=!1,jQuery(".lfb_tmpComponent").remove(),0<t.item.closest("#lfb_componentsPanel").length)return!1},update:function(e,t){}}).disableSelection(),jQuery("#lfb_componentsPanel").find('[data-toggle="switch"]').wrap('<div class="switch"  data-on-label="<i class=\'fui-check\'></i>" data-off-label="<i class=\'fui-cross\'></i>" />').parent().bootstrapSwitch(),jQuery("#lfb_componentsPanel").find('[data-type="slider"]').slider({min:0,max:100,value:50,step:1,orientation:"horizontal",range:"min"}),jQuery("#lfb_componentsPanel").find(".lfb_rate").rate({initial_value:3}).css({color:"#bdc3c7"}),jQuery("#lfb_componentsPanel #lfb_componentsFilters input.form-control").on("keyup change",function(){var e=jQuery(this).val().toLowerCase();jQuery("#lfb_componentsPanel .lfb_componentModel").each(function(){-1<jQuery(this).find(".lfb_componentTitle").text().toLowerCase().indexOf(e)||0==e.trim().length?jQuery(this).show():jQuery(this).hide()})}),lfb_initRowMenu()}})}function lfb_editRow(e){jQuery("#lfb_rowMenu").addClass("lfb_open"),jQuery("#lfb_rowMenu table tbody").html("");for(var t=JSON.parse(e.attr("data-columns")),a=0;a<t.length;a++){addColumnRow(t[a])}}function lfb_initNewItemContent(e){e.find('[data-toggle="switch"][data-checkboxstyle="switch"]').each(function(){0==jQuery(this).closest(".switch").length&&jQuery(this).wrap('<div class="switch"  data-on-label="<i class=\'fui-check\'></i>" data-off-label="<i class=\'fui-cross\'></i>" />').parent().bootstrapSwitch()}),e.find(".lfb_colorpicker").each(function(){jQuery(this);jQuery(this).prev(".lfb_colorPreview").click(function(){tld_selectionMode||jQuery(this).next(".lfb_colorpicker").trigger("click")}),jQuery(this).prev(".lfb_colorPreview").css({backgroundColor:form.colorA}),jQuery(this).colpick({color:form.colorA,layout:"hex",onSubmit:function(){jQuery("body > .colpick").fadeOut()},onChange:function(e,t,a,i,n){jQuery(i).val("#"+t),jQuery(i).prev(".lfb_colorPreview").css({backgroundColor:"#"+t})}})}),e.find('img[data-tint="true"]').each(function(){jQuery(this).css("opacity",0),jQuery(this).show();var e=jQuery('<canvas class="img"></canvas>');e.css({width:jQuery(this).get(0).width,height:jQuery(this).get(0).height}),jQuery(this).hide(),jQuery(this).after(e);var t=e.get(0).getContext("2d"),a=new Image;a.onload=function(){t.fillStyle=form.colorA,t.fillRect(0,0,e.get(0).width,e.get(0).height),t.fill(),t.globalCompositeOperation="destination-in",t.drawImage(a,0,0,e.get(0).width,e.get(0).height)},jQuery(this).is("[data-lazy-src]")?a.src=jQuery(this).attr("data-lazy-src"):a.src=jQuery(this).attr("src")}),e.find('[data-type="slider"]:not(.ui-slider)').each(function(){var e=parseInt(jQuery(this).attr("data-min"));isNaN(e)&&(e=0);var t=parseInt(jQuery(this).attr("data-max"));0==t&&(t=30),jQuery(this).slider({min:e,max:t,value:0,step:1,orientation:"horizontal",range:"min"})}),e.find(".lfb_rate").each(function(){var e,t,a;0==jQuery(this).children().length&&(e=parseInt(jQuery(this).closest(".itemBloc").attr("data-max")),t=parseInt(jQuery(this).closest(".itemBloc").attr("data-value")),isNaN(t)&&(t=5),a="#bdc3c7",""!=jQuery(this).closest(".itemBloc").attr("data-color")&&(a=jQuery(this).closest(".itemBloc").attr("data-color")),-1==a.indexOf("#")&&(a="#"+a),jQuery(this).closest(".itemBloc").attr("data-interval"),jQuery(this).rate({initial_value:t,max_value:e,step_size:1}).css("color",a))})}function lfb_initItemContent(e){e.find(".lfb_column").sortable({connectWith:".lfb_sortable",revert:10,delay:200,scroll:!1,items:".lfb_item",start:function(e,t){jQuery("#estimation_popup").addClass("lfb_draggingComponent"),t.helper.css("background-color",jQuery("#mainPanel").css("background-color"))},over:function(e,t){},receive:function(e,t){lfb_copyHelper=null,jQuery("#lfb_rowMenu").removeClass("lfb_open"),0<t.sender.closest(".lfb_lPanelBodyContent").length?lfb_renderComponent(t.item,jQuery(this).attr("data-columnid")):(t.item.removeClass("col-md-2"),setTimeout(function(){lfb_updateItemsSortOrder()},100))},stop:function(e,t){jQuery(this).is(".lfb_column")?t.item.removeClass("col-md-2"):(t.item.removeClass("col-md-12"),t.item.addClass("col-md-2")),jQuery("#estimation_popup").removeClass("lfb_draggingComponent")},update:function(e,t){}}).disableSelection()}function lfb_initItemToolbar(a){var e=jQuery('<div class="lfb_elementToolbar"></div>');e.append('<a href="javascript:" class="btn-primary lfb-handler"><span class="fas fa-arrows-alt" data-tooltip="true"  data-placement="bottom" title="'+lfb_data.texts.move+'"></span></a>'),e.append('<a href="javascript:" data-action="edit" class="btn-default"><span class="fas fa-pencil-alt" data-tooltip="true"  data-placement="bottom" title="'+lfb_data.texts.edit+'"></span></a>'),a.is(".lfb_row")||e.append('<a href="javascript:" data-action="duplicate" class="btn-default"><span class="fas fa-copy" data-tooltip="true"  data-placement="bottom" title="'+lfb_data.texts.duplicate+'"></span></a>'),e.append('<a href="javascript:" data-action="style" class="btn-default"><span class="fas fa-magic" data-tooltip="true"  data-placement="bottom" title="'+lfb_data.texts.style+'"></span></a>'),e.append('<a href="javascript:" data-action="delete" class="btn-danger"><span class="fas fa-trash" data-tooltip="true"  data-placement="bottom" title="'+lfb_data.texts.remove+'"></span></a>'),e.find('[data-action="edit"]').click(function(){lfb_editedItem=jQuery(this).closest(".lfb_item"),"row"==jQuery(this).closest(".lfb_item").attr("data-itemtype")?lfb_editRow(a):window.parent.lfb_editItem(jQuery(this).closest(".lfb_item").attr("data-id"))}),e.find('[data-action="style"]').click(function(){var e='.lfb_item[data-id="'+a.attr("data-id")+'"]',t=lfb_currentStepID;0==t&&(t="final"),window.parent.lfb_openFormDesigner(t,e)}),e.find('[data-action="duplicate"]').click(function(){window.parent.lfb_duplicateItem(jQuery(this).closest(".lfb_item").attr("data-id"))}),e.find('[data-action="delete"]').click(function(){window.parent.lfb_askDeleteItem(jQuery(this).closest(".lfb_item").attr("data-id"))}),a.prepend(e),a.hover(function(){clearTimeout(lfb_elementHoverTimer);var e=!1;jQuery(this).find(".lfb_item").each(function(){jQuery(this).is(":hover")&&(e=!0)}),(lfb_isDraggingComponent&&0<jQuery(this).find(".lfb-column-inner.lfb_hoverEdit").length||!lfb_isDraggingComponent&&0<jQuery(this).find(".lfb-column-inner:hover").length)&&(e=!0),e?(jQuery(this).removeClass("lfb_hover"),jQuery(this).removeClass("lfb_hoverEdit")):(jQuery(".lfb_hoverEdit").removeClass("lfb_hoverEdit"),jQuery(this).addClass("lfb_hover"),jQuery(this).addClass("lfb_hoverEdit"));jQuery(this);jQuery(this).parent().closest(".lfb_item ").removeClass("lfb_hover")},function(){var e=jQuery(this);e.removeClass("lfb_hover"),e.children(".lfb_hover").removeClass("lfb_hover"),lfb_elementHoverTimer=setTimeout(function(){e.removeClass("lfb_hoverEdit"),e.children(".lfb_hoverEdit").removeClass("lfb_hoverEdit")},500),0<jQuery(this).closest(".lfb_item :hover").length&&jQuery(this).closest(".lfb_item :hover").trigger("mouseenter")}),a.prepend('<div class="lfb_itemLoader"><div class="lfb_spinner" data-tldinit="true"><div class="double-bounce1" data-tldinit="true"></div><div class="double-bounce2" data-tldinit="true"></div></div></div>'),a.find(".lfb_itemLoader").show().fadeOut(500)}function lfb_onItemDeleted(e){0<jQuery('.lfb_item[data-id="'+e+'"]').length&&(jQuery('.lfb_item[data-id="'+e+'"]').remove(),lfb_editedItem&&lfb_editedItem.attr("data-id")==e&&jQuery("#lfb_rowMenuCloseBtn").trigger("click"))}function lfb_renderComponent(a,e){var t=a.index();a.prepend('<div class="lfb_itemLoader"><div class="lfb_spinner" data-tldinit="true"><div class="double-bounce1" data-tldinit="true"></div><div class="double-bounce2" data-tldinit="true"></div></div></div>'),a.find(".lfb_itemLoader").show();jQuery('<div class="lfb_elementContent"></div>');var i=a.attr("data-component"),n=lfb_data.texts.Item;0<jQuery('#lfb_componentsPanel .lfb_componentModel[data-component="'+i+'"] .lfb_componentTitle').length&&(n=jQuery('#lfb_componentsPanel .lfb_componentModel[data-component="'+i+'"] .lfb_componentTitle').text()),jQuery.ajax({url:lfb_data.ajaxurl,type:"post",data:{action:"lfb_createNewItem",formID:jQuery("#estimation_popup").attr("data-form"),stepID:jQuery(".genSlide.lfb_activeStep").attr("data-stepid"),title:n,type:i,columnID:e,index:t},success:function(e){var t=(e=JSON.parse(e)).itemData;window.parent.lfb_newItemAdded(t),$item=jQuery(e.itemDom),a.after($item),lfb_initItemToolbar($item),lfb_initNewItemContent($item),lfb_initItemContent($item),a.remove(),lfb_updateItemsSortOrder()}})}function lfb_showComponentsMenu(){jQuery("#lfb_componentsFilters input").val("").trigger("keyup"),jQuery("#lfb_componentsFilters input").focus(),jQuery("#lfb_componentsPanel").addClass("lfb_open")}jQuery(window).on("load",function(){lfb_currentFormID=jQuery("#estimation_popup").attr("data-form"),void 0!==window.parent.lfb_stepFrameLoaded&&window.parent.lfb_stepFrameLoaded()});